<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet author="jmiranda (generated)" id="1282772258416-1">
        <addColumn tableName="shipment_method">
            <column name="shipper_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282772321026-16">
        <createIndex indexName="FK40203B263896C98E" tableName="shipment_method" unique="false">
            <column name="shipper_id"/>
        </createIndex>
    </changeSet>    
    <changeSet author="jmiranda (generated)" id="1282861095818-1">
        <createIndex indexName="FK335CD11B6631D8CC" tableName="document" unique="false">
            <column name="document_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-2">
        <createIndex indexName="FK167303507D4BD1B" tableName="drug_product" unique="false">
            <column name="drug_route_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-3">
        <createIndex indexName="FK16730350BF6C3E5C" tableName="drug_product" unique="false">
            <column name="dosage_form_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-4">
        <createIndex indexName="FK16730350C2308EF4" tableName="drug_product" unique="false">
            <column name="package_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-5">
        <createIndex indexName="FK5C6729A3D970DB4" tableName="event" unique="false">
            <column name="event_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-6">
        <createIndex indexName="FKFE01941612A19DA7" tableName="inventory_item" unique="false">
            <column name="inventory_lot_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-7">
        <createIndex indexName="FK714F9FB561ED379F" tableName="location" unique="false">
            <column name="address_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-8">
        <createIndex indexName="FKED8DCCEFE0FEE896" tableName="product" unique="false">
            <column name="generic_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-9">
        <createIndex indexName="FK6C229EBE4F1E306E" tableName="product_attribute_value" unique="false">
            <column name="product_attribute_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-10">
        <createIndex indexName="FKD790DEBD154F600" tableName="reference_number" unique="false">
            <column name="reference_number_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-11">
        <createIndex indexName="FKE139719AA28CC5FB" tableName="shipment" unique="false">
            <column name="shipment_method_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-12">
        <createIndex indexName="FKC398CCBAC4A49BBF" tableName="shipment_comment" unique="false">
            <column name="comment_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-13">
        <createIndex indexName="FK6C5BE20C800AA15" tableName="shipment_document" unique="false">
            <column name="document_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-14">
        <createIndex indexName="FK6D032BB5786431F" tableName="shipment_event" unique="false">
            <column name="event_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-15">
        <createIndex indexName="FK40203B26296B2CA3" tableName="shipment_method" unique="false">
            <column name="shipper_service_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-17">
        <createIndex indexName="FK312F6C292388BC5" tableName="shipment_reference_number" unique="false">
            <column name="reference_number_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-18">
        <createIndex indexName="FKDF7559D73896C98E" tableName="shipper_service" unique="false">
            <column name="shipper_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-19">
        <createIndex indexName="FK7FA0D2DEB3FB7111" tableName="transaction" unique="false">
            <column name="transaction_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-20">
        <createIndex indexName="FKABC21FD12EF4C7F4" tableName="transaction_entry" unique="false">
            <column name="transaction_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-21">
        <createIndex indexName="FK143BF46AFF37FDB5" tableName="user_role" unique="false">
            <column name="role_id"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1283380563115-1">
        <addColumn tableName="container">
            <column name="container_status" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283380563115-2">
        <addColumn tableName="location">
            <column name="logo" type="MEDIUMBLOB"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283380563115-3">
        <addColumn tableName="user">
            <column name="photo" type="MEDIUMBLOB"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283826482822-1">
        <createTable tableName="receipt">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="actual_delivery_date" type="DATETIME"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="expected_delivery_date" type="DATETIME"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="recipient_id" type="BIGINT"/>
            <column name="shipment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>        
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283826482822-2">
        <createTable tableName="receipt_item">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="comment_id" type="BIGINT"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="expiration_date" type="DATETIME"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="lot_number" type="VARCHAR(255)"/>
            <column name="product_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_delivered" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_received" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="receipt_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="recipient_id" type="BIGINT"/>
            <column name="serial_number" type="VARCHAR(255)"/>
            <column name="accepted" type="BIT"/>
            <column name="comment" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>    
    <changeSet author="jmiranda (generated)" id="1283827447136-1">
        <insert tableName="event_type">
            <column name="id" valueNumeric="7"/>
            <column name="version" valueNumeric="1"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description" value="Shipment is in transit"/>
            <column name="event_status" value="PENDING"/>
            <column name="last_updated" valueDate="2010-09-02"/>
            <column name="name" value="In Transit"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1284059441612-1">
        <addColumn tableName="event_type">
            <column name="activity_type" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-2">
		<sql>
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 1;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 2;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 3;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 4;		
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 5;		
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 6;
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 7;							
		</sql>		
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-3">
        <addColumn tableName="location">
            <column name="managed_locally" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-4">
    	<comment>Allow all locations to be managed by this deployment.</comment>
		<sql>
			UPDATE location SET managed_locally = 1;		
		</sql>		
    </changeSet>

    <changeSet author="jmiranda (generated)" id="1284743822481-1">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FK408272383B5F6286"/></not></preConditions>    
        <createIndex indexName="FK408272383B5F6286" tableName="receipt" unique="false">
            <column name="shipment_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-2">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FK4082723844979D51"/></not></preConditions>    
        <createIndex indexName="FK4082723844979D51" tableName="receipt" unique="false">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-3">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BA44979D51"/></not></preConditions>    
        <createIndex indexName="FKAE3064BA44979D51" tableName="receipt_item" unique="false">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-4">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BADED5FAE7"/></not></preConditions>    
        <createIndex indexName="FKAE3064BADED5FAE7" tableName="receipt_item" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-5">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BAF7076438"/></not></preConditions>    
        <createIndex indexName="FKAE3064BAF7076438" tableName="receipt_item" unique="false">
            <column name="receipt_id"/>
        </createIndex>
    </changeSet>
	<changeSet author="jmiranda" id="1284743822481-6">
		<sql>
			ALTER TABLE address ENGINE = InnoDB;
			ALTER TABLE address ENGINE = InnoDB;
			ALTER TABLE attribute ENGINE = InnoDB;
			ALTER TABLE attribute_value ENGINE = InnoDB;
			ALTER TABLE category ENGINE = InnoDB;
			ALTER TABLE comment ENGINE = InnoDB;
			ALTER TABLE container ENGINE = InnoDB;
			ALTER TABLE container_type ENGINE = InnoDB;
			ALTER TABLE document ENGINE = InnoDB;
			ALTER TABLE document_type ENGINE = InnoDB;
			ALTER TABLE donor ENGINE = InnoDB;
			ALTER TABLE dosage_form ENGINE = InnoDB;
			ALTER TABLE drug_class ENGINE = InnoDB;
			ALTER TABLE drug_product ENGINE = InnoDB;
			ALTER TABLE drug_route_type ENGINE = InnoDB;
			ALTER TABLE durable_product ENGINE = InnoDB;
			ALTER TABLE event ENGINE = InnoDB;
			ALTER TABLE event_type ENGINE = InnoDB;
			ALTER TABLE generic_type ENGINE = InnoDB;
			ALTER TABLE inventory ENGINE = InnoDB;
			ALTER TABLE inventory_item ENGINE = InnoDB;
			ALTER TABLE inventory_lot ENGINE = InnoDB;
			ALTER TABLE location ENGINE = InnoDB;
			ALTER TABLE package_type ENGINE = InnoDB;
			ALTER TABLE person ENGINE = InnoDB;
			ALTER TABLE product ENGINE = InnoDB;
			ALTER TABLE product_attribute ENGINE = InnoDB;
			ALTER TABLE product_attribute_value ENGINE = InnoDB;
			ALTER TABLE product_category ENGINE = InnoDB;
			ALTER TABLE product_name ENGINE = InnoDB;
			ALTER TABLE product_tags ENGINE = InnoDB;
			ALTER TABLE product_type ENGINE = InnoDB;
			ALTER TABLE receipt ENGINE = InnoDB;
			ALTER TABLE receipt_item ENGINE = InnoDB;
			ALTER TABLE reference_number ENGINE = InnoDB;
			ALTER TABLE reference_number_type ENGINE = InnoDB;
			ALTER TABLE role ENGINE = InnoDB;
			ALTER TABLE shipment ENGINE = InnoDB;
			ALTER TABLE shipment_comment ENGINE = InnoDB;
			ALTER TABLE shipment_document ENGINE = InnoDB;
			ALTER TABLE shipment_event ENGINE = InnoDB;
			ALTER TABLE shipment_item ENGINE = InnoDB;
			ALTER TABLE shipment_method ENGINE = InnoDB;
			ALTER TABLE shipment_reference_number ENGINE = InnoDB;
			ALTER TABLE shipment_type ENGINE = InnoDB;
			ALTER TABLE shipment_type_container_type ENGINE = InnoDB;
			ALTER TABLE shipper ENGINE = InnoDB;
			ALTER TABLE shipper_service ENGINE = InnoDB;
			ALTER TABLE transaction ENGINE = InnoDB;
			ALTER TABLE transaction_entry ENGINE = InnoDB;
			ALTER TABLE transaction_type ENGINE = InnoDB;
			ALTER TABLE user ENGINE = InnoDB;
			ALTER TABLE user_role ENGINE = InnoDB;
			ALTER TABLE value ENGINE = InnoDB;			
		</sql>
	</changeSet>
	
	
    <changeSet author="jmiranda (generated)" id="1284743822481-7">
		<validCheckSum>52fee9405a1c7a89bb4779b1d17af6ba</validCheckSum>		
    	<comment>The sort order is used to sort the different event types chronologically.</comment>
		<sql>
			UPDATE event_type SET sort_order = 1 where id = 1;		
			UPDATE event_type SET sort_order = 2 where id = 2;		
			UPDATE event_type SET sort_order = 3 where id = 3;		
			UPDATE event_type SET sort_order = 4 where id = 4;		
			UPDATE event_type SET sort_order = 6 where id = 5;		
			UPDATE event_type SET sort_order = 7 where id = 6;
			UPDATE event_type SET sort_order = 5 where id = 7;							
		</sql>		
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1284743822481-8">
    	<comment>The event status field is used to distinguish between INITAL, PENDING, COMPLETE states.</comment>
		<sql>
			UPDATE event_type SET event_status = 'INITIAL' where id = 1;		
			UPDATE event_type SET event_status = 'PENDING' where id = 2;		
			UPDATE event_type SET event_status = 'PENDING' where id = 3;		
			UPDATE event_type SET event_status = 'COMPLETE' where id = 4;		
			UPDATE event_type SET event_status = 'INITIAL' where id = 5;		
			UPDATE event_type SET event_status = 'COMPLETE' where id = 6;
			UPDATE event_type SET event_status = 'PENDING' where id = 7;							
		</sql>		
    </changeSet>    
	<changeSet author="jmiranda (generated)" id="1284790199445-1">	
	    <preConditions onFail="MARK_RAN"><not><indexExists indexName="fk_shipment_item_recipient"/></not></preConditions>
	    <addForeignKeyConstraint constraintName="fk_shipment_item_recipient"
	    	baseTableName="shipment_item" baseColumnNames="recipient_id" referencedTableName="person" referencedColumnNames="id" />
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-1">
        <addColumn tableName="container">
            <column name="sort_order" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-2">
        <addColumn tableName="shipment">
            <column name="flight_information" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-3">
        <dropNotNullConstraint columnDataType="VARCHAR(255)" columnName="content_type" tableName="document"/>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-4">
        <addNotNullConstraint columnDataType="BIT" columnName="accepted" defaultNullValue="" tableName="receipt_item"/>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1288203894188-1">
        <addColumn tableName="shipment_item">
            <column name="shipment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda" id="1288203894188-2">
		<comment>Shipment items are now tied to shipments, rather than containers.</comment>
		<sql>    	
			UPDATE shipment_item AS s
			  INNER JOIN container AS c ON c.id = s.container_id
			  SET s.shipment_id = c.shipment_id
			WHERE s.shipment_id is null or s.shipment_id = 0    
		</sql>
    </changeSet>
    <changeSet author="jmiranda" id="1288203894188-3">
		<comment>Changed named for the Shipped event type.</comment>
		<sql>    	
			UPDATE event_type SET name = 'Shipped' where id = 4 and name = 'Departed';	 
		</sql>
    </changeSet>    
    <changeSet author="jmiranda" id="1288203894188-4">
		<comment>Drop all indices because none of them have a corresponding foreign key constraint.  Generated the SQL for all 'alter table' statements using 'grails schema-export'.</comment>
		<sql>
			alter table `user` drop index FK36EBCB1171F854;
			alter table `user` drop index FK36EBCB41E07A73;		
			alter table attribute drop index FKC7AA9C2FFFE725;
			alter table attribute_value drop index FKD7F53A0E4BFE8EC8;
			alter table attribute_value drop index FKD7F53A0E361812E7;
			alter table category drop index FK302BCFE619A2EF8;
			alter table comment drop index FK38A5EE5FAF1302EB;
			alter table comment drop index FK38A5EE5FF885F087;
			alter table container drop index FKE7814C813B5F6286;
			alter table container drop index FKE7814C814B6A2E03;
			alter table container drop index FKE7814C8117A6E251;
			alter table container drop index FKE7814C8144979D51;
			alter table document drop index FK335CD11B6631D8CC;
			alter table drug_class drop index FKDD770419C427B631;
			alter table drug_product drop index FK167303507D4BD1B;
			alter table drug_product drop index FK16730350BF6C3E5C;
			alter table drug_product drop index FK16730350AE684D06;
			alter table drug_product drop index FK16730350C2308EF4;
			alter table event drop index FK5C6729A4415A5B0;
			alter table event drop index FK5C6729A3D970DB4;
			alter table inventory_item drop index FKFE01941612A19DA7;
			alter table inventory_item drop index FKFE019416DED5FAE7;
			alter table inventory_item drop index FKFE01941672A2C5B4;
			alter table inventory_lot drop index FKA518DDEEDED5FAE7;
			alter table location drop index FK714F9FB561ED379F;
			alter table location drop index FK714F9FB541E07A73;
			alter table location drop index FK714F9FB572A2C5B4;
			alter table product drop index FKED8DCCEFABD88AC6;
			alter table product drop index FKED8DCCEFEF4C770D;
			alter table product drop index FKED8DCCEFE0FEE896;
			alter table product_attribute drop index FK94A534C47B0D087;
			alter table product_attribute drop index FK94A534CDED5FAE7;
			alter table product_attribute_value drop index FK6C229EBE4F1E306E;
			alter table product_attribute_value drop index FK6C229EBE361812E7;
			alter table product_category drop index FKA0303E4EEF4C770D;
			alter table product_category drop index FKA0303E4EDED5FAE7;
			alter table product_name drop index FK3C7623DBDED5FAE7;
			alter table product_tags drop index FK3C78DD69DED5FAE7;
			alter table product_type drop index FK3C79388A4F625531;
			alter table receipt drop index FK408272383B5F6286;
			alter table receipt drop index FK4082723844979D51;
			alter table receipt_item drop index FKAE3064BAF7076438;
			alter table receipt_item drop index FKAE3064BA44979D51;
			alter table receipt_item drop index FKAE3064BADED5FAE7;
			alter table reference_number drop index FKD790DEBD154F600;
			alter table shipment drop index FKE139719AA28CC5FB;
			alter table shipment drop index FKE139719ADBDEDAC4;
			alter table shipment drop index FKE139719A49AB6B52;
			alter table shipment drop index FKE139719A44979D51;
			alter table shipment drop index FKE139719A1E2B3CDC;
			alter table shipment drop index FKE139719A294C1012;
			alter table shipment drop index FKE139719AFF77FF9B;
			alter table shipment_comment drop index FKC398CCBAC4A49BBF;
			alter table shipment_document drop index FK6C5BE20C800AA15;
			alter table shipment_event drop index FK6D032BB53B350242;
			alter table shipment_event drop index FK6D032BB5786431F;			
			alter table shipment_item drop index FKDA3BB29849AB6B52;
			alter table shipment_item drop foreign key fk_shipment_item_recipient;
			alter table shipment_item drop index FKDA3BB298DED5FAE7;
			<!--  
			alter table shipment_item drop foreign key FKDA3BB298DED5FAE7;
			-->
			alter table shipment_item drop index FKDA3BB29844979D51;
			alter table shipment_item drop index FKDA3BB2987400E88E;
			alter table shipment_method drop index FK40203B263896C98E;
			alter table shipment_method drop index FK40203B26296B2CA3;
			alter table shipment_reference_number drop index FK312F6C292388BC5;
			alter table shipment_type_container_type drop index FK69C15B8323E731F;
			alter table shipment_type_container_type drop index FK69C15B817A6E251;
			alter table shipper_service drop index FKDF7559D73896C98E;
			alter table transaction drop index FK7FA0D2DE15EC4455;
			alter table transaction drop index FK7FA0D2DEB3FB7111;
			alter table transaction drop index FK7FA0D2DEB9F1C442;
			alter table transaction drop index FK7FA0D2DE72A2C5B4;
			alter table transaction_entry drop index FKABC21FD1DED5FAE7;
			alter table transaction_entry drop index FKABC21FD12EF4C7F4;
			alter table user_role drop index FK143BF46AFF37FDB5;
			alter table user_role drop index FK143BF46AA462C195;
			<!-- INDEX NOT FOUND  
				alter table shipment_item drop index FKDA3BB2983B5F6286;
			-->
		</sql>
	</changeSet>			
    <changeSet author="jmiranda" id="1288203894188-5">
		<comment>Recreate all indices/foreign key constraints.  Generated the SQL for all 'alter table' statements using 'grails schema-export'.</comment>
		<sql>		
			alter table `user` add index FK36EBCB1171F854 (warehouse_id), add constraint FK36EBCB1171F854 foreign key (warehouse_id) references location (id);
			alter table `user` add index FK36EBCB41E07A73 (manager_id), add constraint FK36EBCB41E07A73 foreign key (manager_id) references `user` (id);
			alter table attribute add index FKC7AA9C2FFFE725 (default_value_id), add constraint FKC7AA9C2FFFE725 foreign key (default_value_id) references value (id);
			alter table attribute_value add index FKD7F53A0E4BFE8EC8 (attribute_options_id), add constraint FKD7F53A0E4BFE8EC8 foreign key (attribute_options_id) references attribute (id);
			alter table attribute_value add index FKD7F53A0E361812E7 (value_id), add constraint FKD7F53A0E361812E7 foreign key (value_id) references value (id);
			alter table category add index FK302BCFE619A2EF8 (parent_category_id), add constraint FK302BCFE619A2EF8 foreign key (parent_category_id) references category (id);
			alter table comment add index FK38A5EE5FAF1302EB (sender_id), add constraint FK38A5EE5FAF1302EB foreign key (sender_id) references `user` (id);
			alter table comment add index FK38A5EE5FF885F087 (recipient_id), add constraint FK38A5EE5FF885F087 foreign key (recipient_id) references `user` (id);
			alter table container add index FKE7814C813B5F6286 (shipment_id), add constraint FKE7814C813B5F6286 foreign key (shipment_id) references shipment (id);
			alter table container add index FKE7814C814B6A2E03 (parent_container_id), add constraint FKE7814C814B6A2E03 foreign key (parent_container_id) references container (id);
			alter table container add index FKE7814C8117A6E251 (container_type_id), add constraint FKE7814C8117A6E251 foreign key (container_type_id) references container_type (id);
			alter table container add index FKE7814C8144979D51 (recipient_id), add constraint FKE7814C8144979D51 foreign key (recipient_id) references person (id);
			alter table document add index FK335CD11B6631D8CC (document_type_id), add constraint FK335CD11B6631D8CC foreign key (document_type_id) references document_type (id);
			alter table drug_class add index FKDD770419C427B631 (parent_drug_class_id), add constraint FKDD770419C427B631 foreign key (parent_drug_class_id) references drug_class (id);
			alter table drug_product add index FK167303507D4BD1B (drug_route_type_id), add constraint FK167303507D4BD1B foreign key (drug_route_type_id) references drug_route_type (id);
			alter table drug_product add index FK16730350BF6C3E5C (dosage_form_id), add constraint FK16730350BF6C3E5C foreign key (dosage_form_id) references dosage_form (id);
			alter table drug_product add index FK16730350AE684D06 (drug_class_id), add constraint FK16730350AE684D06 foreign key (drug_class_id) references drug_class (id);
			alter table drug_product add index FK16730350C2308EF4 (package_type_id), add constraint FK16730350C2308EF4 foreign key (package_type_id) references package_type (id);
			alter table event add index FK5C6729A4415A5B0 (event_location_id), add constraint FK5C6729A4415A5B0 foreign key (event_location_id) references location (id);
			alter table event add index FK5C6729A3D970DB4 (event_type_id), add constraint FK5C6729A3D970DB4 foreign key (event_type_id) references event_type (id);
			alter table inventory_item add index FKFE01941612A19DA7 (inventory_lot_id), add constraint FKFE01941612A19DA7 foreign key (inventory_lot_id) references inventory_lot (id);
			alter table inventory_item add index FKFE019416DED5FAE7 (product_id), add constraint FKFE019416DED5FAE7 foreign key (product_id) references product (id);
			alter table inventory_item add index FKFE01941672A2C5B4 (inventory_id), add constraint FKFE01941672A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table inventory_lot add index FKA518DDEEDED5FAE7 (product_id), add constraint FKA518DDEEDED5FAE7 foreign key (product_id) references product (id);
			alter table location add index FK714F9FB561ED379F (address_id), add constraint FK714F9FB561ED379F foreign key (address_id) references address (id);
			alter table location add index FK714F9FB541E07A73 (manager_id), add constraint FK714F9FB541E07A73 foreign key (manager_id) references `user` (id);
			alter table location add index FK714F9FB572A2C5B4 (inventory_id), add constraint FK714F9FB572A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table product add index FKED8DCCEFABD88AC6 (product_type_id), add constraint FKED8DCCEFABD88AC6 foreign key (product_type_id) references product_type (id);
			alter table product add index FKED8DCCEFEF4C770D (category_id), add constraint FKED8DCCEFEF4C770D foreign key (category_id) references category (id);
			alter table product add index FKED8DCCEFE0FEE896 (generic_type_id), add constraint FKED8DCCEFE0FEE896 foreign key (generic_type_id) references generic_type (id);
			alter table product_attribute add index FK94A534C47B0D087 (attribute_id), add constraint FK94A534C47B0D087 foreign key (attribute_id) references attribute (id);
			alter table product_attribute add index FK94A534CDED5FAE7 (product_id), add constraint FK94A534CDED5FAE7 foreign key (product_id) references product (id);
			alter table product_attribute_value add index FK6C229EBE4F1E306E (product_attribute_id), add constraint FK6C229EBE4F1E306E foreign key (product_attribute_id) references product_attribute (id);
			alter table product_attribute_value add index FK6C229EBE361812E7 (value_id), add constraint FK6C229EBE361812E7 foreign key (value_id) references value (id);
			alter table product_category add index FKA0303E4EEF4C770D (category_id), add constraint FKA0303E4EEF4C770D foreign key (category_id) references category (id);
			alter table product_category add index FKA0303E4EDED5FAE7 (product_id), add constraint FKA0303E4EDED5FAE7 foreign key (product_id) references product (id);
			alter table product_name add index FK3C7623DBDED5FAE7 (product_id), add constraint FK3C7623DBDED5FAE7 foreign key (product_id) references product (id);
			alter table product_tags add index FK3C78DD69DED5FAE7 (product_id), add constraint FK3C78DD69DED5FAE7 foreign key (product_id) references product (id);
			alter table product_type add index FK3C79388A4F625531 (parent_product_type_id), add constraint FK3C79388A4F625531 foreign key (parent_product_type_id) references product_type (id);
			alter table receipt add index FK408272383B5F6286 (shipment_id), add constraint FK408272383B5F6286 foreign key (shipment_id) references shipment (id);
			alter table receipt add index FK4082723844979D51 (recipient_id), add constraint FK4082723844979D51 foreign key (recipient_id) references person (id);
			alter table receipt_item add index FKAE3064BAF7076438 (receipt_id), add constraint FKAE3064BAF7076438 foreign key (receipt_id) references receipt (id);
			alter table receipt_item add index FKAE3064BA44979D51 (recipient_id), add constraint FKAE3064BA44979D51 foreign key (recipient_id) references person (id);
			alter table receipt_item add index FKAE3064BADED5FAE7 (product_id), add constraint FKAE3064BADED5FAE7 foreign key (product_id) references product (id);
			alter table reference_number add index FKD790DEBD154F600 (reference_number_type_id), add constraint FKD790DEBD154F600 foreign key (reference_number_type_id) references reference_number_type (id);
			alter table shipment add index FKE139719AA28CC5FB (shipment_method_id), add constraint FKE139719AA28CC5FB foreign key (shipment_method_id) references shipment_method (id);
			alter table shipment add index FKE139719ADBDEDAC4 (origin_id), add constraint FKE139719ADBDEDAC4 foreign key (origin_id) references location (id);
			alter table shipment add index FKE139719A49AB6B52 (donor_id), add constraint FKE139719A49AB6B52 foreign key (donor_id) references donor (id);
			alter table shipment add index FKE139719A44979D51 (recipient_id), add constraint FKE139719A44979D51 foreign key (recipient_id) references person (id);
			alter table shipment add index FKE139719A1E2B3CDC (destination_id), add constraint FKE139719A1E2B3CDC foreign key (destination_id) references location (id);
			alter table shipment add index FKE139719A294C1012 (carrier_id), add constraint FKE139719A294C1012 foreign key (carrier_id) references person (id);
			alter table shipment add index FKE139719AFF77FF9B (shipment_type_id), add constraint FKE139719AFF77FF9B foreign key (shipment_type_id) references shipment_type (id);
			alter table shipment_comment add index FKC398CCBAC4A49BBF (comment_id), add constraint FKC398CCBAC4A49BBF foreign key (comment_id) references comment (id);
			alter table shipment_document add index FK6C5BE20C800AA15 (document_id), add constraint FK6C5BE20C800AA15 foreign key (document_id) references document (id);
			alter table shipment_event add index FK6D032BB53B350242 (shipment_events_id), add constraint FK6D032BB53B350242 foreign key (shipment_events_id) references shipment (id);
			alter table shipment_event add index FK6D032BB5786431F (event_id), add constraint FK6D032BB5786431F foreign key (event_id) references event (id);
			alter table shipment_item add index FKDA3BB2983B5F6286 (shipment_id), add constraint FKDA3BB2983B5F6286 foreign key (shipment_id) references shipment (id);
			alter table shipment_item add index FKDA3BB29849AB6B52 (donor_id), add constraint FKDA3BB29849AB6B52 foreign key (donor_id) references donor (id);
			alter table shipment_item add index FKDA3BB29844979D51 (recipient_id), add constraint FKDA3BB29844979D51 foreign key (recipient_id) references person (id);
			alter table shipment_item add index FKDA3BB298DED5FAE7 (product_id), add constraint FKDA3BB298DED5FAE7 foreign key (product_id) references product (id);
			alter table shipment_item add index FKDA3BB2987400E88E (container_id), add constraint FKDA3BB2987400E88E foreign key (container_id) references container (id);
			alter table shipment_method add index FK40203B263896C98E (shipper_id), add constraint FK40203B263896C98E foreign key (shipper_id) references shipper (id);
			alter table shipment_method add index FK40203B26296B2CA3 (shipper_service_id), add constraint FK40203B26296B2CA3 foreign key (shipper_service_id) references shipper_service (id);
			alter table shipment_reference_number add index FK312F6C292388BC5 (reference_number_id), add constraint FK312F6C292388BC5 foreign key (reference_number_id) references reference_number (id);
			alter table shipment_type_container_type add index FK69C15B8323E731F (shipment_type_container_types_id), add constraint FK69C15B8323E731F foreign key (shipment_type_container_types_id) references shipment_type (id);
			alter table shipment_type_container_type add index FK69C15B817A6E251 (container_type_id), add constraint FK69C15B817A6E251 foreign key (container_type_id) references container_type (id);
			alter table shipper_service add index FKDF7559D73896C98E (shipper_id), add constraint FKDF7559D73896C98E foreign key (shipper_id) references shipper (id);
			alter table transaction add index FK7FA0D2DE15EC4455 (this_warehouse_id), add constraint FK7FA0D2DE15EC4455 foreign key (this_warehouse_id) references location (id);
			alter table transaction add index FK7FA0D2DEB3FB7111 (transaction_type_id), add constraint FK7FA0D2DEB3FB7111 foreign key (transaction_type_id) references transaction_type (id);
			alter table transaction add index FK7FA0D2DEB9F1C442 (target_warehouse_id), add constraint FK7FA0D2DEB9F1C442 foreign key (target_warehouse_id) references location (id);
			alter table transaction add index FK7FA0D2DE72A2C5B4 (inventory_id), add constraint FK7FA0D2DE72A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table transaction_entry add index FKABC21FD1DED5FAE7 (product_id), add constraint FKABC21FD1DED5FAE7 foreign key (product_id) references product (id);
			alter table transaction_entry add index FKABC21FD12EF4C7F4 (transaction_id), add constraint FKABC21FD12EF4C7F4 foreign key (transaction_id) references transaction (id);
			alter table user_role add index FK143BF46AFF37FDB5 (role_id), add constraint FK143BF46AFF37FDB5 foreign key (role_id) references role (id);
			alter table user_role add index FK143BF46AA462C195 (user_id), add constraint FK143BF46AA462C195 foreign key (user_id) references `user` (id);
		</sql>
	</changeSet>    
    <changeSet author="jmiranda" id="1288203894188-6">
		<comment>The parent container of a shipment item must be nullable.</comment>
		<sql>
			ALTER TABLE shipment_item MODIFY COLUMN container_id BIGINT(20) DEFAULT NULL;
		</sql>
	</changeSet>		
    <changeSet author="jmiranda" id="1289252228964-1">
	    <validCheckSum>ee23dff97958f73c667be43f1aeba9f</validCheckSum>
    	<comment>Delete all transaction types.</comment>
    	<sql>	
    		DELETE FROM transaction_type;    	
    	</sql>
	</changeSet>
    <changeSet author="jmiranda" id="1289252228964-2">
    	<validCheckSum>80e35da905d0bbf2c59bfca218834f</validCheckSum>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="1"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Transfer"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="2"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Consumption"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="3"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Adjustment"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="4"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Expired"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="5"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Damaged"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
        <insert tableName="transaction_type">
            <column name="id" valueNumeric="6"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-11-08"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-11-08"/>
            <column name="name" value="Borrowed"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
    </changeSet>
    
	<changeSet author="jmiranda" id="1290012682448-0">
    	<comment>Delete all product types.</comment>
    	<sql>	
		    update product set product_type_id = null;
    	</sql>
	</changeSet>    

	<changeSet author="jmiranda" id="1290012682448-1">
    	<comment>Delete all product types.</comment>
    	<sql>	
		    delete from product_type;
    	</sql>
	</changeSet>    

    <changeSet author="jmiranda (generated)" id="1290012682448-2">
        <insert tableName="product_type">
            <column name="id" valueNumeric="1"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="HIV"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-3">
        <insert tableName="product_type">
            <column name="id" valueNumeric="2"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="TB"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="2"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-4">
        <insert tableName="product_type">
            <column name="id" valueNumeric="3"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Injectable"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="3"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-5">
        <insert tableName="product_type">
            <column name="id" valueNumeric="4"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Lab Supply"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="4"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-6">
        <insert tableName="product_type">
            <column name="id" valueNumeric="5"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Med Supply"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="5"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-7">
        <insert tableName="product_type">
            <column name="id" valueNumeric="6"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Radiology"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="6"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-8">
        <insert tableName="product_type">
            <column name="id" valueNumeric="7"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="SOP"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="7"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-9">
        <insert tableName="product_type">
            <column name="id" valueNumeric="8"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Topical"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="8"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-10">
        <insert tableName="product_type">
            <column name="id" valueNumeric="9"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Narcotic"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="9"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-11">
        <insert tableName="product_type">
            <column name="id" valueNumeric="10"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Oral Med"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="10"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-12">
        <insert tableName="product_type">
            <column name="id" valueNumeric="11"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Eye Care"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="11"/>
        </insert>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290012682448-13">
        <insert tableName="product_type">
            <column name="id" valueNumeric="12"/>
            <column name="version" valueNumeric="0"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description"/>
            <column name="last_updated" valueDate="2010-08-25"/>
            <column name="name" value="Nutrition"/>
            <column name="parent_product_type_id"/>
            <column name="sort_order" valueNumeric="12"/>
        </insert>
    </changeSet> 
	
    <changeSet author="jmiranda (generated)" id="1290446254184-01">
    	<preConditions onFail="MARK_RAN">
    		<tableExists tableName="transaction_entry"/>
    	</preConditions>
		<dropTable tableName="transaction_entry"/>
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1290446254184-02">
    	<preConditions onFail="MARK_RAN">
    		<tableExists tableName="transaction"/>
    	</preConditions>
		<dropTable tableName="transaction"/>
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1290446254184-03">
    	<preConditions onFail="MARK_RAN">
    		<tableExists tableName="inventory_inventory_lot"/>
    	</preConditions>
		<dropTable tableName="inventory_inventory_lot"/>
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1290446254184-04">
    	<preConditions onFail="MARK_RAN">
    		<tableExists tableName="inventory_item"/>
    	</preConditions>
		<dropTable tableName="inventory_item"/>
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1290446254184-05">
    	<preConditions onFail="MARK_RAN">
    		<tableExists tableName="inventory_lot"/>
    	</preConditions>
		<dropTable tableName="inventory_lot"/>		
	</changeSet>
	
    <changeSet author="jmiranda (generated)" id="1290449480096-1">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="inventory_item" /></not>
		</preConditions>   
        <createTable tableName="inventory_item">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="BIT">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="ideal_quantity" type="INT"/>
            <column name="inventory_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="inventory_item_type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="lot_number" type="VARCHAR(255)"/>
            <column name="low_quantity" type="INT"/>
            <column name="max_quantity" type="INT"/>
            <column name="min_quantity" type="INT"/>
            <column name="product_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="reorder_quantity" type="INT"/>
            <column name="serial_number" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-2">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="inventory_lot" /></not>
		</preConditions>   
        <createTable tableName="inventory_lot">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="expiration_date" type="DATETIME"/>
            <column name="initial_quantity" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="inventory_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="lot_number" type="VARCHAR(255)"/>
            <column name="manufacture_date" type="DATETIME"/>
            <column name="product_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>        
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-3">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="location_type" /></not>
		</preConditions>   
        <createTable tableName="location_type">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="sort_order" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-4">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="lookup" /></not>
		</preConditions>   
        <createTable tableName="lookup">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="sort_order" type="INT"/>
            <column name="class" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-5">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="product_code" /></not>
		</preConditions>   
        <createTable tableName="product_code">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="sort_order" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-6">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="product_group" /></not>
		</preConditions>   
        <createTable tableName="product_group">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="sort_order" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-7">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="setting" /></not>
		</preConditions>   
        <createTable tableName="setting">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(7)">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-8">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="transaction" /></not>
		</preConditions>   
        <createTable tableName="transaction">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="created_by_id" type="BIGINT"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="destination_id" type="BIGINT"/>
            <column name="inventory_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="source_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="transaction_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="transaction_type_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-9">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="transaction_entry" /></not>
		</preConditions>   
		<createTable tableName="transaction_entry">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="inventory_item_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="lot_number" type="VARCHAR(255)"/>
            <column name="product_id" type="BIGINT"/>
            <column name="quantity" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="transaction_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-10">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="unit_of_measure" /></not>
		</preConditions>    
        <createTable tableName="unit_of_measure">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-11">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="inventory" columnName="date_created"/></not>
		</preConditions>    
        <addColumn tableName="inventory">
            <column name="date_created" type="DATETIME"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-12">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="inventory" columnName="last_updated"/></not>
		</preConditions>    
        <addColumn tableName="inventory">
            <column name="last_updated" type="DATETIME"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-13">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location" columnName="active"/></not>
		</preConditions>    
        <addColumn tableName="location">
            <column name="active" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-14">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location" columnName="location_type_id"/></not>
		</preConditions>    
        <addColumn tableName="location">
            <column name="location_type_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-15">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location" columnName="parent_location_id"/></not>
		</preConditions>    
        <addColumn tableName="location">
            <column name="parent_location_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-16">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="budget_code_id"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="budget_code_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-17">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="code"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="code" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-18">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="ean"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="ean" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-19">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="french_name"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="french_name" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-20">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="product_group_id"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="product_group_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-21">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="quantity_per_unit"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="quantity_per_unit" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-22">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="sku"/></not>
		</preConditions>    
        <addColumn tableName="product">
            <column name="sku" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-23">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product" columnName="unit_of_measure_id"/></not>
		</preConditions>
		<addColumn tableName="product">
            <column name="unit_of_measure_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290449480096-24">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="product_type" columnName="code"/></not>
		</preConditions>    
        <addColumn tableName="product_type">
            <column name="code" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

	
	
	<!--  Made a mistake in associating the inventory levels with inventory items  -->
	<changeSet author="jmiranda (generated)" id="1290449480096-39">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="inventory_item" columnName="ideal_quantity"/>
		</preConditions>
        <dropColumn tableName="inventory_item" columnName="ideal_quantity"/>
	</changeSet>
	<changeSet author="jmiranda (generated)" id="1290449480096-40">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="inventory_item" columnName="low_quantity"/>
		</preConditions>
        <dropColumn tableName="inventory_item" columnName="low_quantity"/>
    </changeSet>
	<changeSet author="jmiranda (generated)" id="1290449480096-41">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="inventory_item" columnName="max_quantity"/>
		</preConditions>
        <dropColumn tableName="inventory_item" columnName="max_quantity"/>
    </changeSet>
	<changeSet author="jmiranda (generated)" id="1290449480096-42">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="inventory_item" columnName="min_quantity"/>
		</preConditions>
        <dropColumn tableName="inventory_item" columnName="min_quantity"/>
    </changeSet>
	<changeSet author="jmiranda (generated)" id="1290449480096-43">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="inventory_item" columnName="reorder_quantity"/>
		</preConditions>
        <dropColumn tableName="inventory_item" columnName="reorder_quantity"/>
    </changeSet>
	

	<!--  Creating the new inventory level table -->	
    <changeSet author="jmiranda (generated)" id="1290452414238-1">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="inventory_level" /></not>
		</preConditions>    
        <createTable tableName="inventory_level">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="ideal_quantity" type="INT"/>
            <column name="inventory_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="low_quantity" type="INT"/>
            <column name="max_quantity" type="INT"/>
            <column name="min_quantity" type="INT"/>
            <column name="product_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="reorder_quantity" type="INT"/>
        </createTable>
    </changeSet>    
    <changeSet author="jmiranda (generated)" id="1290452414238-2">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="location" columnName="local"/></not>
		</preConditions>
        <addColumn tableName="location">
            <column name="local" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290452414238-3">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="local"/>
		</preConditions>
		<update tableName="location">
		    <column name="local" valueBoolean="true"/>
		</update>
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1290452414238-4">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location" columnName="active"/>
		</preConditions>
		<update tableName="location">
		    <column name="active" valueBoolean="true"/>
		</update>
	</changeSet>
	
    <changeSet author="jmiranda (generated)" id="1290477989262-1a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKFE01941672A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FKFE01941672A2C5B4" tableName="inventory_item" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-1b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKFE01941672A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKFE01941672A2C5B4"
		    baseTableName="inventory_item" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1290477989262-2a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKFE019416DED5FAE7"/></not>
		</preConditions>    
        <createIndex indexName="FKFE019416DED5FAE7" tableName="inventory_item" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-2b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKFE019416DED5FAE7"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKFE019416DED5FAE7"
		    baseTableName="inventory_item" baseColumnNames="product_id"
		    referencedTableName="product" referencedColumnNames="id" />
    </changeSet>    
    
    <changeSet author="jmiranda (generated)" id="1290477989262-3a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKC254A2E172A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FKC254A2E172A2C5B4" tableName="inventory_level" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-3b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKC254A2E172A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKC254A2E172A2C5B4"
		    baseTableName="inventory_level" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>    
    
    <changeSet author="jmiranda (generated)" id="1290477989262-4a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKC254A2E1DED5FAE7"/></not>
		</preConditions>    
        <createIndex indexName="FKC254A2E1DED5FAE7" tableName="inventory_level" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-4b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKC254A2E1DED5FAE7"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKC254A2E1DED5FAE7"
		    baseTableName="inventory_level" baseColumnNames="product_id"
		    referencedTableName="product" referencedColumnNames="id" />
    </changeSet>    
    
    <changeSet author="jmiranda (generated)" id="1290477989262-5a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKA518DDEE72A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FKA518DDEE72A2C5B4" tableName="inventory_lot" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-5b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKA518DDEE72A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKA518DDEE72A2C5B4"
		    baseTableName="inventory_lot" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>        
    
    <changeSet author="jmiranda (generated)" id="1290477989262-6a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKA518DDEEDED5FAE7"/></not>
		</preConditions>    
        <createIndex indexName="FKA518DDEEDED5FAE7" tableName="inventory_lot" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-6b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKA518DDEEDED5FAE7"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKA518DDEEDED5FAE7"
		    baseTableName="inventory_lot" baseColumnNames="product_id"
		    referencedTableName="product" referencedColumnNames="id" />
    </changeSet>  
	<!-- Already exists -->        
	<!--  
    <changeSet author="jmiranda (generated)" id="1290477989262-7a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK714F9FB572A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FK714F9FB572A2C5B4" tableName="location" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-7b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK714F9FB572A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK714F9FB572A2C5B4"
		    baseTableName="location" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>            
	-->
    <changeSet author="jmiranda (generated)" id="1290477989262-8a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK714F9FB57AF9A3C0"/></not>
		</preConditions>    
        <createIndex indexName="FK714F9FB57AF9A3C0" tableName="location" unique="false">
            <column name="parent_location_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-8b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK714F9FB57AF9A3C0"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK714F9FB57AF9A3C0"
		    baseTableName="location" baseColumnNames="parent_location_id"
		    referencedTableName="location" referencedColumnNames="id" />
    </changeSet>            
    
    <changeSet author="jmiranda (generated)" id="1290477989262-9a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK7FA0D2DE10746729"/></not>
		</preConditions>    
        <createIndex indexName="FK7FA0D2DE10746729" tableName="transaction" unique="false">
            <column name="destination_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-9b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK7FA0D2DE10746729"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK7FA0D2DE10746729"
		    baseTableName="transaction" baseColumnNames="destination_id"
		    referencedTableName="location" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1290477989262-10a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK7FA0D2DE217F5972"/></not>
		</preConditions>    
        <createIndex indexName="FK7FA0D2DE217F5972" tableName="transaction" unique="false">
            <column name="created_by_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-10b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK7FA0D2DE217F5972"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK7FA0D2DE217F5972"
		    baseTableName="transaction" baseColumnNames="created_by_id"
		    referencedTableName="user" referencedColumnNames="id" />
    </changeSet> 

    <changeSet author="jmiranda (generated)" id="1290477989262-11a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK7FA0D2DE72A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FK7FA0D2DE72A2C5B4" tableName="transaction" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-11b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK7FA0D2DE72A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK7FA0D2DE72A2C5B4"
		    baseTableName="transaction" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>            
    
    <changeSet author="jmiranda (generated)" id="1290477989262-12a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK7FA0D2DE74CDABFC"/></not>
		</preConditions>    
        <createIndex indexName="FK7FA0D2DE74CDABFC" tableName="transaction" unique="false">
            <column name="source_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-12b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK7FA0D2DE74CDABFC"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK7FA0D2DE74CDABFC"
		    baseTableName="transaction" baseColumnNames="source_id"
		    referencedTableName="location" referencedColumnNames="id" />
    </changeSet>

    <changeSet author="jmiranda (generated)" id="1290477989262-13a">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FKABC21FD1DED5FAE7"/></not>
		</preConditions>    
        <createIndex indexName="FKABC21FD1DED5FAE7" tableName="transaction_entry" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1290477989262-13b">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FKABC21FD1DED5FAE7"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FKABC21FD1DED5FAE7"
		    baseTableName="transaction_entry" baseColumnNames="product_id"
		    referencedTableName="product" referencedColumnNames="id" />
    </changeSet>         
    
    <changeSet author="jmiranda (generated)" id="1291325368079-1">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="transaction" columnName="confirmed"/></not>
		</preConditions>    
        <addColumn tableName="transaction">
            <column name="confirmed" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1291325368079-2">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="transaction" columnName="confirmed_by_id"/></not>
		</preConditions>    
        <addColumn tableName="transaction">
            <column name="confirmed_by_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1291325368079-3">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="transaction" columnName="date_confirmed"/></not>
		</preConditions>    
        <addColumn tableName="transaction">
            <column name="date_confirmed" type="DATETIME"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1291325368079-4">
        <dropNotNullConstraint columnDataType="BIGINT" columnName="inventory_item_id" tableName="transaction_entry"/>
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1291325368079-5">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK714F9FB572A2C5B4"/></not>
		</preConditions>    
        <createIndex indexName="FK714F9FB572A2C5B4" tableName="location" unique="false">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1291325368079-6">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK714F9FB572A2C5B4"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK714F9FB572A2C5B4"
		    baseTableName="location" baseColumnNames="inventory_id"
		    referencedTableName="inventory" referencedColumnNames="id" />
    </changeSet>          

    <changeSet author="jmiranda (generated)" id="1291325368079-7">
		<preConditions onFail="MARK_RAN">
			<not><indexExists indexName="FK7FA0D2DE3265A8A9"/></not>
		</preConditions>    
        <createIndex indexName="FK7FA0D2DE3265A8A9" tableName="transaction" unique="false">
            <column name="confirmed_by_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1291325368079-8">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="FK7FA0D2DE3265A8A9"/></not>
		</preConditions>    
		<addForeignKeyConstraint constraintName="FK7FA0D2DE3265A8A9"
		    baseTableName="transaction" baseColumnNames="confirmed_by_id"
		    referencedTableName="user" referencedColumnNames="id" />
    </changeSet>          
</databaseChangeLog>
