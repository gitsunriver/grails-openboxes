<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    <changeSet author="jmiranda (generated)" id="1282772258416-1">
        <addColumn tableName="shipment_method">
            <column name="shipper_id" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282772321026-16">
        <createIndex indexName="FK40203B263896C98E" tableName="shipment_method" unique="false">
            <column name="shipper_id"/>
        </createIndex>
    </changeSet>    
    <changeSet author="jmiranda (generated)" id="1282861095818-1">
        <createIndex indexName="FK335CD11B6631D8CC" tableName="document" unique="false">
            <column name="document_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-2">
        <createIndex indexName="FK167303507D4BD1B" tableName="drug_product" unique="false">
            <column name="drug_route_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-3">
        <createIndex indexName="FK16730350BF6C3E5C" tableName="drug_product" unique="false">
            <column name="dosage_form_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-4">
        <createIndex indexName="FK16730350C2308EF4" tableName="drug_product" unique="false">
            <column name="package_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-5">
        <createIndex indexName="FK5C6729A3D970DB4" tableName="event" unique="false">
            <column name="event_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-6">
        <createIndex indexName="FKFE01941612A19DA7" tableName="inventory_item" unique="false">
            <column name="inventory_lot_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-7">
        <createIndex indexName="FK714F9FB561ED379F" tableName="location" unique="false">
            <column name="address_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-8">
        <createIndex indexName="FKED8DCCEFE0FEE896" tableName="product" unique="false">
            <column name="generic_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-9">
        <createIndex indexName="FK6C229EBE4F1E306E" tableName="product_attribute_value" unique="false">
            <column name="product_attribute_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-10">
        <createIndex indexName="FKD790DEBD154F600" tableName="reference_number" unique="false">
            <column name="reference_number_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-11">
        <createIndex indexName="FKE139719AA28CC5FB" tableName="shipment" unique="false">
            <column name="shipment_method_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-12">
        <createIndex indexName="FKC398CCBAC4A49BBF" tableName="shipment_comment" unique="false">
            <column name="comment_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-13">
        <createIndex indexName="FK6C5BE20C800AA15" tableName="shipment_document" unique="false">
            <column name="document_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-14">
        <createIndex indexName="FK6D032BB5786431F" tableName="shipment_event" unique="false">
            <column name="event_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-15">
        <createIndex indexName="FK40203B26296B2CA3" tableName="shipment_method" unique="false">
            <column name="shipper_service_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-17">
        <createIndex indexName="FK312F6C292388BC5" tableName="shipment_reference_number" unique="false">
            <column name="reference_number_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-18">
        <createIndex indexName="FKDF7559D73896C98E" tableName="shipper_service" unique="false">
            <column name="shipper_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-19">
        <createIndex indexName="FK7FA0D2DEB3FB7111" tableName="transaction" unique="false">
            <column name="transaction_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-20">
        <createIndex indexName="FKABC21FD12EF4C7F4" tableName="transaction_entry" unique="false">
            <column name="transaction_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1282861095818-21">
        <createIndex indexName="FK143BF46AFF37FDB5" tableName="user_role" unique="false">
            <column name="role_id"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1283380563115-1">
        <addColumn tableName="container">
            <column name="container_status" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283380563115-2">
        <addColumn tableName="location">
            <column name="logo" type="MEDIUMBLOB"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283380563115-3">
        <addColumn tableName="user">
            <column name="photo" type="MEDIUMBLOB"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283826482822-1">
        <createTable tableName="receipt">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="actual_delivery_date" type="DATETIME"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="expected_delivery_date" type="DATETIME"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="recipient_id" type="BIGINT"/>
            <column name="shipment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1283826482822-2">
        <createTable tableName="receipt_item">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="comment_id" type="BIGINT"/>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="expiration_date" type="DATETIME"/>
            <column name="last_updated" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="lot_number" type="VARCHAR(255)"/>
            <column name="product_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_delivered" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_received" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="receipt_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="recipient_id" type="BIGINT"/>
            <column name="serial_number" type="VARCHAR(255)"/>
            <column name="accepted" type="BIT"/>
            <column name="comment" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>    
    <changeSet author="jmiranda (generated)" id="1283827447136-1">
        <insert tableName="event_type">
            <column name="id" valueNumeric="7"/>
            <column name="version" valueNumeric="1"/>
            <column name="date_created" valueDate="2010-08-25"/>
            <column name="description" value="Shipment is in transit"/>
            <column name="event_status" value="PENDING"/>
            <column name="last_updated" valueDate="2010-09-02"/>
            <column name="name" value="In Transit"/>
            <column name="sort_order" valueNumeric="0"/>
        </insert>
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1284059441612-1">
        <addColumn tableName="event_type">
            <column name="activity_type" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-2">
		<sql>
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 1;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 2;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 3;		
			UPDATE event_type SET activity_type = 'SHIPPING' where id = 4;		
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 5;		
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 6;
			UPDATE event_type SET activity_type = 'RECEIVING' where id = 7;							
		</sql>		
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-3">
        <addColumn tableName="location">
            <column name="managed_locally" type="BIT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284059441612-4">
    	<comment>Allow all locations to be managed by this deployment.</comment>
		<sql>
			UPDATE location SET managed_locally = 1;		
		</sql>		
    </changeSet>

    <changeSet author="jmiranda (generated)" id="1284743822481-1">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FK408272383B5F6286"/></not></preConditions>    
        <createIndex indexName="FK408272383B5F6286" tableName="receipt" unique="false">
            <column name="shipment_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-2">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FK4082723844979D51"/></not></preConditions>    
        <createIndex indexName="FK4082723844979D51" tableName="receipt" unique="false">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-3">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BA44979D51"/></not></preConditions>    
        <createIndex indexName="FKAE3064BA44979D51" tableName="receipt_item" unique="false">
            <column name="recipient_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-4">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BADED5FAE7"/></not></preConditions>    
        <createIndex indexName="FKAE3064BADED5FAE7" tableName="receipt_item" unique="false">
            <column name="product_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1284743822481-5">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="FKAE3064BAF7076438"/></not></preConditions>    
        <createIndex indexName="FKAE3064BAF7076438" tableName="receipt_item" unique="false">
            <column name="receipt_id"/>
        </createIndex>
    </changeSet>
	<changeSet author="jmiranda" id="1284743822481-6">
		<sql>
			ALTER TABLE address ENGINE = InnoDB;
			ALTER TABLE address ENGINE = InnoDB;
			ALTER TABLE attribute ENGINE = InnoDB;
			ALTER TABLE attribute_value ENGINE = InnoDB;
			ALTER TABLE category ENGINE = InnoDB;
			ALTER TABLE comment ENGINE = InnoDB;
			ALTER TABLE container ENGINE = InnoDB;
			ALTER TABLE container_type ENGINE = InnoDB;
			ALTER TABLE document ENGINE = InnoDB;
			ALTER TABLE document_type ENGINE = InnoDB;
			ALTER TABLE donor ENGINE = InnoDB;
			ALTER TABLE dosage_form ENGINE = InnoDB;
			ALTER TABLE drug_class ENGINE = InnoDB;
			ALTER TABLE drug_product ENGINE = InnoDB;
			ALTER TABLE drug_route_type ENGINE = InnoDB;
			ALTER TABLE durable_product ENGINE = InnoDB;
			ALTER TABLE event ENGINE = InnoDB;
			ALTER TABLE event_type ENGINE = InnoDB;
			ALTER TABLE generic_type ENGINE = InnoDB;
			ALTER TABLE inventory ENGINE = InnoDB;
			ALTER TABLE inventory_item ENGINE = InnoDB;
			ALTER TABLE inventory_lot ENGINE = InnoDB;
			ALTER TABLE location ENGINE = InnoDB;
			ALTER TABLE package_type ENGINE = InnoDB;
			ALTER TABLE person ENGINE = InnoDB;
			ALTER TABLE product ENGINE = InnoDB;
			ALTER TABLE product_attribute ENGINE = InnoDB;
			ALTER TABLE product_attribute_value ENGINE = InnoDB;
			ALTER TABLE product_category ENGINE = InnoDB;
			ALTER TABLE product_name ENGINE = InnoDB;
			ALTER TABLE product_tags ENGINE = InnoDB;
			ALTER TABLE product_type ENGINE = InnoDB;
			ALTER TABLE receipt ENGINE = InnoDB;
			ALTER TABLE receipt_item ENGINE = InnoDB;
			ALTER TABLE reference_number ENGINE = InnoDB;
			ALTER TABLE reference_number_type ENGINE = InnoDB;
			ALTER TABLE role ENGINE = InnoDB;
			ALTER TABLE shipment ENGINE = InnoDB;
			ALTER TABLE shipment_comment ENGINE = InnoDB;
			ALTER TABLE shipment_document ENGINE = InnoDB;
			ALTER TABLE shipment_event ENGINE = InnoDB;
			ALTER TABLE shipment_item ENGINE = InnoDB;
			ALTER TABLE shipment_method ENGINE = InnoDB;
			ALTER TABLE shipment_reference_number ENGINE = InnoDB;
			ALTER TABLE shipment_type ENGINE = InnoDB;
			ALTER TABLE shipment_type_container_type ENGINE = InnoDB;
			ALTER TABLE shipper ENGINE = InnoDB;
			ALTER TABLE shipper_service ENGINE = InnoDB;
			ALTER TABLE transaction ENGINE = InnoDB;
			ALTER TABLE transaction_entry ENGINE = InnoDB;
			ALTER TABLE transaction_type ENGINE = InnoDB;
			ALTER TABLE user ENGINE = InnoDB;
			ALTER TABLE user_role ENGINE = InnoDB;
			ALTER TABLE value ENGINE = InnoDB;			
		</sql>
	</changeSet>
	
	
    <changeSet author="jmiranda (generated)" id="1284743822481-7">
		<validCheckSum>52fee9405a1c7a89bb4779b1d17af6ba</validCheckSum>		
    	<comment>The sort order is used to sort the different event types chronologically.</comment>
		<sql>
			UPDATE event_type SET sort_order = 1 where id = 1;		
			UPDATE event_type SET sort_order = 2 where id = 2;		
			UPDATE event_type SET sort_order = 3 where id = 3;		
			UPDATE event_type SET sort_order = 4 where id = 4;		
			UPDATE event_type SET sort_order = 6 where id = 5;		
			UPDATE event_type SET sort_order = 7 where id = 6;
			UPDATE event_type SET sort_order = 5 where id = 7;							
		</sql>		
    </changeSet>
    
    <changeSet author="jmiranda (generated)" id="1284743822481-8">
    	<comment>The event status field is used to distinguish between INITAL, PENDING, COMPLETE states.</comment>
		<sql>
			UPDATE event_type SET event_status = 'INITIAL' where id = 1;		
			UPDATE event_type SET event_status = 'PENDING' where id = 2;		
			UPDATE event_type SET event_status = 'PENDING' where id = 3;		
			UPDATE event_type SET event_status = 'COMPLETE' where id = 4;		
			UPDATE event_type SET event_status = 'INITIAL' where id = 5;		
			UPDATE event_type SET event_status = 'COMPLETE' where id = 6;
			UPDATE event_type SET event_status = 'PENDING' where id = 7;							
		</sql>		
    </changeSet>    
	<changeSet author="jmiranda (generated)" id="1284790199445-1">	
	    <preConditions onFail="MARK_RAN"><not><indexExists indexName="fk_shipment_item_recipient"/></not></preConditions>
	    <addForeignKeyConstraint constraintName="fk_shipment_item_recipient"
	    	baseTableName="shipment_item" baseColumnNames="recipient_id" referencedTableName="person" referencedColumnNames="id" />
	</changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-1">
        <addColumn tableName="container">
            <column name="sort_order" type="INT"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-2">
        <addColumn tableName="shipment">
            <column name="flight_information" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-3">
        <dropNotNullConstraint columnDataType="VARCHAR(255)" columnName="content_type" tableName="document"/>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1287544235753-4">
        <addNotNullConstraint columnDataType="BIT" columnName="accepted" defaultNullValue="" tableName="receipt_item"/>
    </changeSet>
    <changeSet author="jmiranda (generated)" id="1288203894188-1">
        <addColumn tableName="shipment_item">
            <column name="shipment_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet author="jmiranda" id="1288203894188-2">
		<comment>Shipment items are now tied to shipments, rather than containers.</comment>
		<sql>    	
			UPDATE shipment_item AS s
			  INNER JOIN container AS c ON c.id = s.container_id
			  SET s.shipment_id = c.shipment_id
			WHERE s.shipment_id is null or s.shipment_id = 0    
		</sql>
    </changeSet>
    <changeSet author="jmiranda" id="1288203894188-3">
		<comment>Changed named for the Shipped event type.</comment>
		<sql>    	
			UPDATE event_type SET name = 'Shipped' where id = 4 and name = 'Departed';	 
		</sql>
    </changeSet>    
    <changeSet author="jmiranda" id="1288203894188-4">
		<comment>Drop all indices because none of them have a corresponding foreign key constraint.  Generated the SQL for all 'alter table' statements using 'grails schema-export'.</comment>
		<sql>
			alter table `user` drop index FK36EBCB1171F854;
			alter table `user` drop index FK36EBCB41E07A73;		
			alter table attribute drop index FKC7AA9C2FFFE725;
			alter table attribute_value drop index FKD7F53A0E4BFE8EC8;
			alter table attribute_value drop index FKD7F53A0E361812E7;
			alter table category drop index FK302BCFE619A2EF8;
			alter table comment drop index FK38A5EE5FAF1302EB;
			alter table comment drop index FK38A5EE5FF885F087;
			alter table container drop index FKE7814C813B5F6286;
			alter table container drop index FKE7814C814B6A2E03;
			alter table container drop index FKE7814C8117A6E251;
			alter table container drop index FKE7814C8144979D51;
			alter table document drop index FK335CD11B6631D8CC;
			alter table drug_class drop index FKDD770419C427B631;
			alter table drug_product drop index FK167303507D4BD1B;
			alter table drug_product drop index FK16730350BF6C3E5C;
			alter table drug_product drop index FK16730350AE684D06;
			alter table drug_product drop index FK16730350C2308EF4;
			alter table event drop index FK5C6729A4415A5B0;
			alter table event drop index FK5C6729A3D970DB4;
			alter table inventory_item drop index FKFE01941612A19DA7;
			alter table inventory_item drop index FKFE019416DED5FAE7;
			alter table inventory_item drop index FKFE01941672A2C5B4;
			alter table inventory_lot drop index FKA518DDEEDED5FAE7;
			alter table location drop index FK714F9FB561ED379F;
			alter table location drop index FK714F9FB541E07A73;
			alter table location drop index FK714F9FB572A2C5B4;
			alter table product drop index FKED8DCCEFABD88AC6;
			alter table product drop index FKED8DCCEFEF4C770D;
			alter table product drop index FKED8DCCEFE0FEE896;
			alter table product_attribute drop index FK94A534C47B0D087;
			alter table product_attribute drop index FK94A534CDED5FAE7;
			alter table product_attribute_value drop index FK6C229EBE4F1E306E;
			alter table product_attribute_value drop index FK6C229EBE361812E7;
			alter table product_category drop index FKA0303E4EEF4C770D;
			alter table product_category drop index FKA0303E4EDED5FAE7;
			alter table product_name drop index FK3C7623DBDED5FAE7;
			alter table product_tags drop index FK3C78DD69DED5FAE7;
			alter table product_type drop index FK3C79388A4F625531;
			alter table receipt drop index FK408272383B5F6286;
			alter table receipt drop index FK4082723844979D51;
			alter table receipt_item drop index FKAE3064BAF7076438;
			alter table receipt_item drop index FKAE3064BA44979D51;
			alter table receipt_item drop index FKAE3064BADED5FAE7;
			alter table reference_number drop index FKD790DEBD154F600;
			alter table shipment drop index FKE139719AA28CC5FB;
			alter table shipment drop index FKE139719ADBDEDAC4;
			alter table shipment drop index FKE139719A49AB6B52;
			alter table shipment drop index FKE139719A44979D51;
			alter table shipment drop index FKE139719A1E2B3CDC;
			alter table shipment drop index FKE139719A294C1012;
			alter table shipment drop index FKE139719AFF77FF9B;
			alter table shipment_comment drop index FKC398CCBAC4A49BBF;
			alter table shipment_document drop index FK6C5BE20C800AA15;
			alter table shipment_event drop index FK6D032BB53B350242;
			alter table shipment_event drop index FK6D032BB5786431F;			
			alter table shipment_item drop index FKDA3BB29849AB6B52;
			alter table shipment_item drop foreign key fk_shipment_item_recipient;
			alter table shipment_item drop index FKDA3BB298DED5FAE7;
			<!--  
			alter table shipment_item drop foreign key FKDA3BB298DED5FAE7;
			-->
			alter table shipment_item drop index FKDA3BB29844979D51;
			alter table shipment_item drop index FKDA3BB2987400E88E;
			alter table shipment_method drop index FK40203B263896C98E;
			alter table shipment_method drop index FK40203B26296B2CA3;
			alter table shipment_reference_number drop index FK312F6C292388BC5;
			alter table shipment_type_container_type drop index FK69C15B8323E731F;
			alter table shipment_type_container_type drop index FK69C15B817A6E251;
			alter table shipper_service drop index FKDF7559D73896C98E;
			alter table transaction drop index FK7FA0D2DE15EC4455;
			alter table transaction drop index FK7FA0D2DEB3FB7111;
			alter table transaction drop index FK7FA0D2DEB9F1C442;
			alter table transaction drop index FK7FA0D2DE72A2C5B4;
			alter table transaction_entry drop index FKABC21FD1DED5FAE7;
			alter table transaction_entry drop index FKABC21FD12EF4C7F4;
			alter table user_role drop index FK143BF46AFF37FDB5;
			alter table user_role drop index FK143BF46AA462C195;
			<!-- INDEX NOT FOUND  
				alter table shipment_item drop index FKDA3BB2983B5F6286;
			-->
		</sql>
	</changeSet>			
    <changeSet author="jmiranda" id="1288203894188-5">
		<comment>Recreate all indices/foreign key constraints.  Generated the SQL for all 'alter table' statements using 'grails schema-export'.</comment>
		<sql>		
			alter table `user` add index FK36EBCB1171F854 (warehouse_id), add constraint FK36EBCB1171F854 foreign key (warehouse_id) references location (id);
			alter table `user` add index FK36EBCB41E07A73 (manager_id), add constraint FK36EBCB41E07A73 foreign key (manager_id) references `user` (id);
			alter table attribute add index FKC7AA9C2FFFE725 (default_value_id), add constraint FKC7AA9C2FFFE725 foreign key (default_value_id) references value (id);
			alter table attribute_value add index FKD7F53A0E4BFE8EC8 (attribute_options_id), add constraint FKD7F53A0E4BFE8EC8 foreign key (attribute_options_id) references attribute (id);
			alter table attribute_value add index FKD7F53A0E361812E7 (value_id), add constraint FKD7F53A0E361812E7 foreign key (value_id) references value (id);
			alter table category add index FK302BCFE619A2EF8 (parent_category_id), add constraint FK302BCFE619A2EF8 foreign key (parent_category_id) references category (id);
			alter table comment add index FK38A5EE5FAF1302EB (sender_id), add constraint FK38A5EE5FAF1302EB foreign key (sender_id) references `user` (id);
			alter table comment add index FK38A5EE5FF885F087 (recipient_id), add constraint FK38A5EE5FF885F087 foreign key (recipient_id) references `user` (id);
			alter table container add index FKE7814C813B5F6286 (shipment_id), add constraint FKE7814C813B5F6286 foreign key (shipment_id) references shipment (id);
			alter table container add index FKE7814C814B6A2E03 (parent_container_id), add constraint FKE7814C814B6A2E03 foreign key (parent_container_id) references container (id);
			alter table container add index FKE7814C8117A6E251 (container_type_id), add constraint FKE7814C8117A6E251 foreign key (container_type_id) references container_type (id);
			alter table container add index FKE7814C8144979D51 (recipient_id), add constraint FKE7814C8144979D51 foreign key (recipient_id) references person (id);
			alter table document add index FK335CD11B6631D8CC (document_type_id), add constraint FK335CD11B6631D8CC foreign key (document_type_id) references document_type (id);
			alter table drug_class add index FKDD770419C427B631 (parent_drug_class_id), add constraint FKDD770419C427B631 foreign key (parent_drug_class_id) references drug_class (id);
			alter table drug_product add index FK167303507D4BD1B (drug_route_type_id), add constraint FK167303507D4BD1B foreign key (drug_route_type_id) references drug_route_type (id);
			alter table drug_product add index FK16730350BF6C3E5C (dosage_form_id), add constraint FK16730350BF6C3E5C foreign key (dosage_form_id) references dosage_form (id);
			alter table drug_product add index FK16730350AE684D06 (drug_class_id), add constraint FK16730350AE684D06 foreign key (drug_class_id) references drug_class (id);
			alter table drug_product add index FK16730350C2308EF4 (package_type_id), add constraint FK16730350C2308EF4 foreign key (package_type_id) references package_type (id);
			alter table event add index FK5C6729A4415A5B0 (event_location_id), add constraint FK5C6729A4415A5B0 foreign key (event_location_id) references location (id);
			alter table event add index FK5C6729A3D970DB4 (event_type_id), add constraint FK5C6729A3D970DB4 foreign key (event_type_id) references event_type (id);
			alter table inventory_item add index FKFE01941612A19DA7 (inventory_lot_id), add constraint FKFE01941612A19DA7 foreign key (inventory_lot_id) references inventory_lot (id);
			alter table inventory_item add index FKFE019416DED5FAE7 (product_id), add constraint FKFE019416DED5FAE7 foreign key (product_id) references product (id);
			alter table inventory_item add index FKFE01941672A2C5B4 (inventory_id), add constraint FKFE01941672A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table inventory_lot add index FKA518DDEEDED5FAE7 (product_id), add constraint FKA518DDEEDED5FAE7 foreign key (product_id) references product (id);
			alter table location add index FK714F9FB561ED379F (address_id), add constraint FK714F9FB561ED379F foreign key (address_id) references address (id);
			alter table location add index FK714F9FB541E07A73 (manager_id), add constraint FK714F9FB541E07A73 foreign key (manager_id) references `user` (id);
			alter table location add index FK714F9FB572A2C5B4 (inventory_id), add constraint FK714F9FB572A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table product add index FKED8DCCEFABD88AC6 (product_type_id), add constraint FKED8DCCEFABD88AC6 foreign key (product_type_id) references product_type (id);
			alter table product add index FKED8DCCEFEF4C770D (category_id), add constraint FKED8DCCEFEF4C770D foreign key (category_id) references category (id);
			alter table product add index FKED8DCCEFE0FEE896 (generic_type_id), add constraint FKED8DCCEFE0FEE896 foreign key (generic_type_id) references generic_type (id);
			alter table product_attribute add index FK94A534C47B0D087 (attribute_id), add constraint FK94A534C47B0D087 foreign key (attribute_id) references attribute (id);
			alter table product_attribute add index FK94A534CDED5FAE7 (product_id), add constraint FK94A534CDED5FAE7 foreign key (product_id) references product (id);
			alter table product_attribute_value add index FK6C229EBE4F1E306E (product_attribute_id), add constraint FK6C229EBE4F1E306E foreign key (product_attribute_id) references product_attribute (id);
			alter table product_attribute_value add index FK6C229EBE361812E7 (value_id), add constraint FK6C229EBE361812E7 foreign key (value_id) references value (id);
			alter table product_category add index FKA0303E4EEF4C770D (category_id), add constraint FKA0303E4EEF4C770D foreign key (category_id) references category (id);
			alter table product_category add index FKA0303E4EDED5FAE7 (product_id), add constraint FKA0303E4EDED5FAE7 foreign key (product_id) references product (id);
			alter table product_name add index FK3C7623DBDED5FAE7 (product_id), add constraint FK3C7623DBDED5FAE7 foreign key (product_id) references product (id);
			alter table product_tags add index FK3C78DD69DED5FAE7 (product_id), add constraint FK3C78DD69DED5FAE7 foreign key (product_id) references product (id);
			alter table product_type add index FK3C79388A4F625531 (parent_product_type_id), add constraint FK3C79388A4F625531 foreign key (parent_product_type_id) references product_type (id);
			alter table receipt add index FK408272383B5F6286 (shipment_id), add constraint FK408272383B5F6286 foreign key (shipment_id) references shipment (id);
			alter table receipt add index FK4082723844979D51 (recipient_id), add constraint FK4082723844979D51 foreign key (recipient_id) references person (id);
			alter table receipt_item add index FKAE3064BAF7076438 (receipt_id), add constraint FKAE3064BAF7076438 foreign key (receipt_id) references receipt (id);
			alter table receipt_item add index FKAE3064BA44979D51 (recipient_id), add constraint FKAE3064BA44979D51 foreign key (recipient_id) references person (id);
			alter table receipt_item add index FKAE3064BADED5FAE7 (product_id), add constraint FKAE3064BADED5FAE7 foreign key (product_id) references product (id);
			alter table reference_number add index FKD790DEBD154F600 (reference_number_type_id), add constraint FKD790DEBD154F600 foreign key (reference_number_type_id) references reference_number_type (id);
			alter table shipment add index FKE139719AA28CC5FB (shipment_method_id), add constraint FKE139719AA28CC5FB foreign key (shipment_method_id) references shipment_method (id);
			alter table shipment add index FKE139719ADBDEDAC4 (origin_id), add constraint FKE139719ADBDEDAC4 foreign key (origin_id) references location (id);
			alter table shipment add index FKE139719A49AB6B52 (donor_id), add constraint FKE139719A49AB6B52 foreign key (donor_id) references donor (id);
			alter table shipment add index FKE139719A44979D51 (recipient_id), add constraint FKE139719A44979D51 foreign key (recipient_id) references person (id);
			alter table shipment add index FKE139719A1E2B3CDC (destination_id), add constraint FKE139719A1E2B3CDC foreign key (destination_id) references location (id);
			alter table shipment add index FKE139719A294C1012 (carrier_id), add constraint FKE139719A294C1012 foreign key (carrier_id) references person (id);
			alter table shipment add index FKE139719AFF77FF9B (shipment_type_id), add constraint FKE139719AFF77FF9B foreign key (shipment_type_id) references shipment_type (id);
			alter table shipment_comment add index FKC398CCBAC4A49BBF (comment_id), add constraint FKC398CCBAC4A49BBF foreign key (comment_id) references comment (id);
			alter table shipment_document add index FK6C5BE20C800AA15 (document_id), add constraint FK6C5BE20C800AA15 foreign key (document_id) references document (id);
			alter table shipment_event add index FK6D032BB53B350242 (shipment_events_id), add constraint FK6D032BB53B350242 foreign key (shipment_events_id) references shipment (id);
			alter table shipment_event add index FK6D032BB5786431F (event_id), add constraint FK6D032BB5786431F foreign key (event_id) references event (id);
			alter table shipment_item add index FKDA3BB2983B5F6286 (shipment_id), add constraint FKDA3BB2983B5F6286 foreign key (shipment_id) references shipment (id);
			alter table shipment_item add index FKDA3BB29849AB6B52 (donor_id), add constraint FKDA3BB29849AB6B52 foreign key (donor_id) references donor (id);
			alter table shipment_item add index FKDA3BB29844979D51 (recipient_id), add constraint FKDA3BB29844979D51 foreign key (recipient_id) references person (id);
			alter table shipment_item add index FKDA3BB298DED5FAE7 (product_id), add constraint FKDA3BB298DED5FAE7 foreign key (product_id) references product (id);
			alter table shipment_item add index FKDA3BB2987400E88E (container_id), add constraint FKDA3BB2987400E88E foreign key (container_id) references container (id);
			alter table shipment_method add index FK40203B263896C98E (shipper_id), add constraint FK40203B263896C98E foreign key (shipper_id) references shipper (id);
			alter table shipment_method add index FK40203B26296B2CA3 (shipper_service_id), add constraint FK40203B26296B2CA3 foreign key (shipper_service_id) references shipper_service (id);
			alter table shipment_reference_number add index FK312F6C292388BC5 (reference_number_id), add constraint FK312F6C292388BC5 foreign key (reference_number_id) references reference_number (id);
			alter table shipment_type_container_type add index FK69C15B8323E731F (shipment_type_container_types_id), add constraint FK69C15B8323E731F foreign key (shipment_type_container_types_id) references shipment_type (id);
			alter table shipment_type_container_type add index FK69C15B817A6E251 (container_type_id), add constraint FK69C15B817A6E251 foreign key (container_type_id) references container_type (id);
			alter table shipper_service add index FKDF7559D73896C98E (shipper_id), add constraint FKDF7559D73896C98E foreign key (shipper_id) references shipper (id);
			alter table transaction add index FK7FA0D2DE15EC4455 (this_warehouse_id), add constraint FK7FA0D2DE15EC4455 foreign key (this_warehouse_id) references location (id);
			alter table transaction add index FK7FA0D2DEB3FB7111 (transaction_type_id), add constraint FK7FA0D2DEB3FB7111 foreign key (transaction_type_id) references transaction_type (id);
			alter table transaction add index FK7FA0D2DEB9F1C442 (target_warehouse_id), add constraint FK7FA0D2DEB9F1C442 foreign key (target_warehouse_id) references location (id);
			alter table transaction add index FK7FA0D2DE72A2C5B4 (inventory_id), add constraint FK7FA0D2DE72A2C5B4 foreign key (inventory_id) references inventory (id);
			alter table transaction_entry add index FKABC21FD1DED5FAE7 (product_id), add constraint FKABC21FD1DED5FAE7 foreign key (product_id) references product (id);
			alter table transaction_entry add index FKABC21FD12EF4C7F4 (transaction_id), add constraint FKABC21FD12EF4C7F4 foreign key (transaction_id) references transaction (id);
			alter table user_role add index FK143BF46AFF37FDB5 (role_id), add constraint FK143BF46AFF37FDB5 foreign key (role_id) references role (id);
			alter table user_role add index FK143BF46AA462C195 (user_id), add constraint FK143BF46AA462C195 foreign key (user_id) references `user` (id);
		</sql>
	</changeSet>    
    <changeSet author="jmiranda" id="1288203894188-6">
		<comment>The parent container of a shipment item must be nullable.</comment>
		<sql>
			ALTER TABLE shipment_item MODIFY COLUMN container_id BIGINT(20) DEFAULT NULL;
		</sql>
	</changeSet>
</databaseChangeLog>
